
{% extends "base.html" %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VIKOR ‚Äì Compromise Ranking Method</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="container">

<!-- Back to MCDA Home -->
<div class="mt-3">
  <a href="/" class="btn btn-outline-primary">
    <i class="fas fa-home"></i> Back to MCDA Home
  </a>
</div>


  <!-- Page header -->
  <div class="text-center my-4">
    <h2><strong>VIKOR ‚Äì Compromise Ranking Method</strong></h2>
    <p class="text-muted">Evaluate companies using compromise ranking (S, R, Q)</p>
  </div>

  <!-- ƒåe ni izbranih podjetij -->
  {% if not companies %}
  <div class="alert alert-warning text-center">
    ‚ö†Ô∏è No companies selected yet. Please go to <a href="{{ url_for('mcda_bp.select_companies') }}">Selection</a>.
  </div>
  {% else %}

  <!-- Izbrana podjetja -->
  <div class="table-responsive mb-5">
    <h4 class="text-center mb-3">üè¢ Selected Companies</h4>
    <table class="table table-bordered table-hover align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>Company</th>
          {% for crit in criteria_names %}
          <th>{{ crit }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for comp in companies %}
        <tr>
          <td>{{ comp.name }}</td>
          {% for val in comp.criteria %}
          <td>{{ val }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Rezultati VIKOR -->
  {% if results %}
  <div class="table-responsive">
    <h4 class="text-center mb-3">üìä VIKOR Results</h4>
    <table class="table table-bordered table-hover align-middle text-center">
      <thead class="table-light">
        <tr>
          <th>Rank</th>
          <th>Company</th>
          <th>S (Utility)</th>
          <th>R (Regret)</th>
          <th>Q (VIKOR Index)</th>
        </tr>
      </thead>
      <tbody>
        {% for row in results %}
        <tr {% if loop.index == 1 %}class="table-success"{% elif loop.index == results|length %}class="table-danger"{% endif %}>
          <td>{{ loop.index }}</td>
          <td>{{ row.name }}</td>
          <td>{{ '%.3f'|format(row.S) }}</td>
          <td>{{ '%.3f'|format(row.R) }}</td>
          <td><strong>{{ '%.3f'|format(row.Q) }}</strong></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Interpretacija -->
  <div class="alert alert-info mt-4">
    <strong>Best choice:</strong> {{ interpretation.best }}<br>
    <strong>Worst choice:</strong> {{ interpretation.worst }}<br>
    <em>{{ interpretation.note }}</em>
  </div>



<!-- Graf -->
  {% if plot_data %}
  <div class="my-5">
    <h5 class="text-center">VIKOR Q Index Visualization</h5>
    <canvas id="vikorChart" height="120"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('vikorChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: {{ plot_data.labels|tojson }},
        datasets: [{
          label: 'VIKOR Q Index (lower = better)',
          data: {{ plot_data.scores|tojson }},
          backgroundColor: 'rgba(75, 192, 192, 0.6)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        indexAxis: 'y',
        scales: {
          x: {
            min: 0, max: 1,
            title: { display: true, text: 'Q (Compromise Solution Index)' }
          }
        }
      }
    });
  </script>

  {% endif %}
  
   {% endif %}   <!-- zapira else (companies) -->
 
  {% endif %} 

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

{% endblock %}