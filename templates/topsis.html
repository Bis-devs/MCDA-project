{% extends "base.html" %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TOPSIS ‚Äì Technique for Order of Preference by Similarity to Ideal Solution</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="container">



  <!-- Back to MCDA Home -->
  <div class="mt-3">
    <a href="/" class="btn btn-outline-primary">
      <i class="fas fa-home"></i> Back to MCDA Home
    </a>
  </div>

  <!-- Page header -->
  <div class="text-center my-4">
    <h2><strong>TOPSIS ‚Äì Technique for Order of Preference by Similarity to Ideal Solution</strong></h2>
    <p class="text-muted">Evaluate companies based on their closeness to the ideal solution</p>
  </div>

  <!-- ƒåe ni izbranih podjetij -->
  {% if not companies %}
    <div class="alert alert-warning text-center">
      ‚ö†Ô∏è No companies selected yet. Please go to
      <a href="{{ url_for('mcda_bp.select_companies') }}">Selection</a>.
    </div>
  {% else %}

    <!-- Tabela izbranih podjetij -->
    <div class="table-responsive mb-5">
      <h4 class="text-center mb-3">üè¢ Selected Companies</h4>
      <table class="table table-bordered table-hover align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Company</th>
            {% for crit in criteria_names %}
              <th>{{ crit }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for comp in companies %}
            <tr>
              <td>{{ comp.name }}</td>
              {% for val in comp.criteria %}
                <td>{{ val }}</td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Results Table -->
    {% if results %}
      <div class="table-responsive">
        <h4 class="text-center mb-3">üìä TOPSIS Results</h4>
        <table class="table table-bordered table-hover align-middle text-center">
          <thead class="table-light">
            <tr>
              <th>Rank</th>
              <th>Company</th>
              {% for crit in criteria_names %}
                <th>{{ crit }} (Norm, Weighted)</th>
              {% endfor %}
              <th>TOPSIS Score</th>
            </tr>
          </thead>
          <tbody>
            {% for row in results %}
              <tr {% if loop.index == 1 %}class="table-success"{% elif loop.index == results|length %}class="table-danger"{% endif %}>
                <td>{{ loop.index }}</td>
                <td>{{ row.name }}</td>
                {% for norm, weighted in row.pairs %}
                  <td>{{ '%.3f'|format(norm) }}, {{ '%.3f'|format(weighted) }}</td>
                {% endfor %}
                <td><strong>{{ '%.3f'|format(row.score) }}</strong></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Interpretation -->
      <div class="alert alert-info mt-4">
        <strong>Best choice:</strong> {{ interpretation.best }}<br>
        <strong>Worst choice:</strong> {{ interpretation.worst }}<br>
        {% if interpretation.score_gap is not none %}
          <strong>Score gap between top 2:</strong> {{ interpretation.score_gap }}
        {% endif %}<br>
        <em>{{ interpretation.note }}</em>
      </div>

      {% if interpretation.percent_scores %}
        <div class="mt-4">
          <h5>Percent Closeness to Ideal</h5>
          <ul>
            {% for item in interpretation.percent_scores %}
              <li>{{ item.name }} ‚Üí {{ item.percent }}%</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}

      {% if interpretation.stability %}
        <div class="alert alert-secondary mt-3">
          <strong>Ranking Stability:</strong> {{ interpretation.stability }}
        </div>
      {% endif %}

      {% if plot_data %}
        <div class="my-5">
          <h5 class="text-center">TOPSIS Scores Visualization</h5>
          <canvas id="topsisChart" height="120"></canvas>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
          const ctx = document.getElementById('topsisChart').getContext('2d');
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: {{ plot_data.labels|tojson }},
              datasets: [{
                label: 'TOPSIS Score (0‚Äì1)',
                data: {{ plot_data.scores|tojson }},
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
              }]
            },
            options: {
              indexAxis: 'y',
              scales: {
                x: {
                  min: 0,
                  max: 1,
                  title: { display: true, text: 'Closeness to Ideal (TOPSIS Score)' }
                }
              }
            }
          });
        </script>
      {% endif %}
    {% endif %} {# konec if results #}

  {% endif %} {# konec outer if companies #}

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
{% endblock %}