
{% extends "base.html" %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WSM - Weighted Sum Model</title>
    <!-- Bootswatch Lux theme -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.0/dist/lux/bootstrap.min.css">
</head>
<body class="container">

    <!-- Home button -->
    <div class="mt-3">
        <a href="/" class="btn btn-outline-primary">
            <i class="fas fa-home"></i> Back to MCDA Home
        </a>
    </div>

    <!-- Page header -->
    <div class="text-center my-5">
        <h2><strong>WSM ‚Äì Weighted Sum Model</strong></h2>
        <p class="text-muted">Ranking of the selected companies</p>
    </div>

    {% if not companies %}
        <div class="alert alert-warning text-center">
            üö´ No companies selected yet. Please go to 
            <a href="{{ url_for('mcda_bp.select_companies') }}">Selection</a>.
        </div>
    {% else %}
        <!-- Selected Companies Table -->
        <div class="mcda-table">
            <h4 class="text-center mb-3">üè¢ Selected Companies</h4>
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Company</th>
                        <th>Revenue (M)</th>
                        <th>Revenue Growth %</th>
                        <th>Profit (M)</th>
                        <th>Profit Growth %</th>
                        <th>Assets (M)</th>
                        <th>Employees</th>
                        <th>ROA %</th>
                    </tr>
                </thead>
                <tbody>
                {% for comp in companies %}
                    <tr>
                        <td>{{ comp.name }}</td>
                        <td>{{ comp.revenues_million }}</td>
                        <td>{{ comp.revenue_percent_change }}</td>
                        <td>{{ comp.profits_million }}</td>
                        <td>{{ comp.profits_percent_change }}</td>
                        <td>{{ comp.assets_million }}</td>
                        <td>{{ comp.employees }}</td>
                        <td>
                            {{ "%.2f"|format((comp.profits_million / comp.assets_million * 100) if comp.assets_million else 0) }}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Normalized & Weighted Scores -->
        {% if results %}
        <div class="table-responsive">
            <h4 class="text-center mb-3">üìä Normalized, Weighted Scores and Final Result</h4>
            <table class="table table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th rowspan="2">Company</th>
                        {% for c in criteria_names %}
                            <th colspan="2">{{ c }}</th>
                        {% endfor %}
                        <th rowspan="2">WSM Score</th>
                    </tr>
                    <tr>
                        {% for c in criteria_names %}
                            <th>Norm</th>
                            <th>Weighted</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                {% for res in results %}
                    <tr>
                        <td>{{ res.name }}</td>
                        {% for norm, weighted in res.pairs %}
                            <td>{{ "%.3f"|format(norm) }}</td>
                            <td>{{ "%.3f"|format(weighted) }}</td>
                        {% endfor %}
                        <td><strong>{{ res.score }}</strong></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Final decision -->
        {% set best = results | max(attribute='score') %}
        <div class="text-center my-4 p-3 border rounded bg-light">
            <h4>üèÜ Final Decision (WSM): <strong>{{ best.name }}</strong></h4>
            <p>Highest score: <strong>{{ best.score }}</strong></p>
        </div>
        {% endif %}
    {% endif %}

</body>
</html>

{% endblock %}